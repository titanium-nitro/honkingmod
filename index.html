<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HonkingMod</title>
<style>
:root{--bg:#ffcccc;--panel:#cce0ff;--accent:#cc0000;--accent2:#0000cc;--danger:#990000;--border:#330000;--muted:#660000;}
html,body{margin:0;height:100%;font-family:Tahoma,Verdana,sans-serif;background:var(--bg);}
.app{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-columns:280px 1fr;gap:12px;}
.card{background:var(--panel);border:3px solid var(--border);padding:10px;border-radius:6px;box-shadow:4px 4px 0 #000;}
h1,h2{margin:6px 0;font-weight:bold;color:#000;text-shadow:1px 1px #fff;}
label{display:block;margin-top:6px;font-size:13px;font-weight:bold;}
input[type=text],input[type=password]{width:100%;padding:6px;border-radius:4px;border:2px inset #ccc;background:#fff;color:#000;font-size:13px;}
button{cursor:pointer;padding:6px 10px;border-radius:4px;border:2px outset #999;background:var(--accent);color:#fff;font-weight:bold;box-shadow:2px 2px 0 #000;}
button:active{border:2px inset #999;box-shadow:none;}
.muted{color:var(--muted);font-size:12px;}
.users-list{max-height:260px;overflow:auto;margin-top:10px;}
.user-item{display:flex;align-items:center;gap:8px;padding:6px;background:#fff;border:2px solid #000;margin:4px 0;}
.avatar{width:32px;height:32px;border:2px solid #000;border-radius:4px;background:var(--accent2);display:flex;align-items:center;justify-content:center;font-weight:bold;}
.main{display:flex;flex-direction:column;gap:12px;}
.topbar{display:flex;justify-content:space-between;align-items:center;background:var(--accent2);border:3px solid #000;}
.world{height:400px;border:3px solid #000;border-radius:6px;display:flex;overflow:hidden;background:#ffffff;}
.canvas{flex:1;background:#99ddff;display:flex;flex-direction:column;}
.chat{width:280px;border-left:3px solid #000;display:flex;flex-direction:column;background:#fffbe6;}
.messages{flex:1;padding:8px;overflow:auto;font-size:13px;}
.msg{margin-bottom:6px;border-bottom:1px dashed #aaa;padding-bottom:4px;}
.composer{display:flex;padding:6px;gap:6px;background:#ffeb99;border-top:3px solid #000;}
.composer input{flex:1;}
.danger{background:var(--danger)!important;}
footer{margin-top:12px;text-align:center;font-size:12px;color:#000;}
@media(max-width:900px){.app{grid-template-columns:1fr;}.world{height:300px;flex-direction:column;}.chat{width:100%;border-left:none;border-top:3px solid #000;}}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1>HonkingMod Accounts</h1>

    <!-- HARD-CODED LOGIN / REGISTER WITH NICKNAME -->
    <label>Nickname</label>
    <input id="auth-nickname" type="text" placeholder="Choose a nickname">
    <label>Email</label>
    <input id="auth-email" type="text" placeholder="you@example.com">
    <label>Password</label>
    <input id="auth-password" type="password" placeholder="password">
    <div style="margin-top:6px;display:flex;gap:6px;">
      <button id="btn-register">Register</button>
      <button id="btn-login">Login</button>
      <button id="btn-logout" style="display:none;">Logout</button>
    </div>

    <div id="me-name" style="margin-top:6px;font-weight:bold;"></div>

    <hr style="margin:10px 0;border:2px dashed #000">
    <h2>Users</h2>
    <div class="muted">Accounts and chat are stored online.</div>
    <div class="users-list" id="users-list"></div>
  </div>

  <div class="main">
    <div class="card topbar">
      <div><h1>HonkingMod World</h1><div class="muted">Scratch + 2008 Roblox style</div></div>
      <div class="muted">Current: <span id="top-current">(none)</span></div>
    </div>

    <div class="world">
      <div class="canvas">
        <div style="padding:6px;display:flex;gap:8px;align-items:center;background:#ffeb99;border-bottom:3px solid #000">
          <div class="avatar" id="canvas-avatar">ðŸ™‚</div>
          <div><div id="canvas-name">Guest</div><div class="muted">Click HONK!</div></div>
        </div>
        <div style="padding:12px;flex:1">
          <button id="honkhonk" disabled>HONK!</button>
        </div>
      </div>

      <div class="chat">
        <div style="padding:6px;border-bottom:3px solid #000;background:var(--accent2);color:#fff"><strong>Global Chat</strong></div>
        <div class="messages" id="messages" aria-live="polite"></div>
        <div class="composer">
          <input id="chat-input" type="text" placeholder="Say something..." disabled>
          <button id="send-chat" disabled>Send</button>
        </div>
      </div>
    </div>
    <footer class="card">HonkingMod â€” powered by Firebase. Shared chat/accounts.</footer>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-firestore-compat.js"></script>
<script>
// Config
const firebaseConfig = {
  apiKey: "AIzaSyAgsn_BkIWvlenmsAOXaWGfkuGH0H50AiM",
  authDomain: "honkingmod.firebaseapp.com",
  projectId: "honkingmod",
  storageBucket: "honkingmod.appspot.com",
  messagingSenderId: "484991397323",
  appId: "1:484991397323:web:5b1f72eaa0b6c3d0abcdef"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// DOM helpers
const $id = id => document.getElementById(id);

// --- AUTH ---
$id('btn-register').addEventListener('click', async ()=>{
  const nickname = $id('auth-nickname').value.trim();
  const email = $id('auth-email').value.trim();
  const pass = $id('auth-password').value;
  if(!nickname || !email||!pass) return alert('Enter nickname, email, and password');
  try{
    const cred = await auth.createUserWithEmailAndPassword(email,pass);
    await db.collection('users').doc(cred.user.uid).set({ displayName:nickname });
    alert('Registered as '+nickname);
  }catch(e){alert(e.message);}
});

$id('btn-login').addEventListener('click', async ()=>{
  const email = $id('auth-email').value.trim();
  const pass = $id('auth-password').value;
  if(!email||!pass)return alert('Enter email and password');
  try{ await auth.signInWithEmailAndPassword(email,pass); }catch(e){alert(e.message);}
});

$id('btn-logout').addEventListener('click', ()=>{ auth.signOut(); });

// --- CHAT ---
$id('send-chat').addEventListener('click', sendChat);
$id('chat-input').addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });
$id('honkhonk').addEventListener('click', ()=>{
  const user = auth.currentUser;
  if(!user) return;
  db.collection('messages').add({author:user.uid,text:'HONK!',time:Date.now()});
});

async function sendChat(){
  const user = auth.currentUser;
  const msg = $id('chat-input').value.trim();
  if(!user||!msg)return;
  await db.collection('messages').add({author:user.uid,text:msg,time:Date.now()});
  $id('chat-input').value='';
}

// --- UI updates ---
let messagesUnsub=null;
auth.onAuthStateChanged(async user=>{
  if(user){
    $id('btn-logout').style.display='inline';
    $id('btn-login').style.display='none';
    $id('btn-register').style.display='none';
    $id('chat-input').disabled=false;
    $id('send-chat').disabled=false;
    $id('honkhonk').disabled=false;

    // Get nickname
    const snap = await db.collection('users').doc(user.uid).get();
    const nickname = snap.exists ? snap.data().displayName : 'Anon';

    $id('me-name').textContent='Logged in: '+nickname;
    $id('canvas-name').textContent=nickname;
    $id('canvas-avatar').textContent=nickname[0].toUpperCase();
    $id('top-current').textContent=nickname;

    // Users list
    $id('users-list').innerHTML='<div class="user-item"><div class="avatar">'+nickname[0].toUpperCase()+'</div><div><strong>'+nickname+'</strong></div></div>';

    // Messages listener
    if(messagesUnsub) messagesUnsub();
    messagesUnsub = db.collection('messages').orderBy('time').onSnapshot(async snap=>{
      const mEl = $id('messages');
      mEl.innerHTML='';
      for(const doc of snap.docs){
        const data = doc.data();
        const uSnap = await db.collection('users').doc(data.author).get();
        const displayName = uSnap.exists ? uSnap.data().displayName : 'Anon';
        const div = document.createElement('div');
        div.className='msg';
        div.textContent = displayName + ': ' + data.text;
        mEl.appendChild(div);
      }
      mEl.scrollTop=mEl.scrollHeight;
    });
  }else{
    $id('btn-logout').style.display='none';
    $id('btn-login').style.display='inline';
    $id('btn-register').style.display='inline';
    $id('me-name').textContent='';
    $id('canvas-name').textContent='Guest';
    $id('canvas-avatar').textContent='ðŸ™‚';
    $id('top-current').textContent='(none)';
    $id('chat-input').disabled=true;
    $id('send-chat').disabled=true;
    $id('honkhonk').disabled=true;
    $id('users-list').innerHTML='';
    $id('messages').innerHTML='';
    if(messagesUnsub) messagesUnsub();
  }
});
</script>
</body>
</html>
