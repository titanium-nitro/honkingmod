<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HonkingMod</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

:root {
  --sonic-blue: #0033cc;
  --knuckles-red: #cc0000;
  --border: #ffff00;
  --bg1: #111;
  --bg2: #222;
}

body {
  margin:0;
  font-family:'Press Start 2P', monospace;
  background: repeating-linear-gradient(
    45deg,
    var(--bg1),
    var(--bg1) 20px,
    var(--bg2) 20px,
    var(--bg2) 40px
  );
  color:#fff;
}

h1 {
  text-align:center;
  padding:12px;
  margin:0;
  font-size:18px;
  background:linear-gradient(to right, var(--sonic-blue), var(--knuckles-red));
  -webkit-text-stroke:1px black;
}

.container {
  display:grid;
  grid-template-columns:250px 1fr 250px;
  gap:10px;
  max-width:1200px;
  margin:0 auto;
  padding:10px;
}

.panel {
  background:#000;
  border:4px solid var(--border);
  padding:8px;
  border-radius:0;
  box-shadow:4px 4px 0 #444;
}

button {
  display:block;
  width:100%;
  background:var(--sonic-blue);
  color:#fff;
  border:4px solid var(--knuckles-red);
  padding:10px;
  margin:6px 0;
  cursor:pointer;
  font-family:'Press Start 2P', monospace;
  font-size:10px;
  text-transform:uppercase;
}
button:disabled {
  background:#555;
  border-color:#333;
  cursor:not-allowed;
}

input {
  width:95%;
  margin:4px 0;
  padding:6px;
  border:3px solid var(--knuckles-red);
  background:#111;
  color:#fff;
  font-family:'Press Start 2P', monospace;
  font-size:10px;
}

#messages {
  max-height:250px;
  overflow-y:auto;
  background:#111;
  border:3px solid var(--sonic-blue);
  padding:4px;
  font-size:10px;
}

.msg { margin:2px 0; }

.user-item {
  display:flex; align-items:center;
  font-size:10px; margin:3px 0;
}

.avatar {
  width:24px; height:24px;
  background:var(--knuckles-red);
  display:flex; align-items:center; justify-content:center;
  margin-right:5px;
  border:2px solid var(--sonic-blue);
  font-size:12px;
}

#license-card {
  margin-top:10px;
  padding:6px;
  background:#111;
  border:3px solid var(--sonic-blue);
  font-size:10px;
}
</style>
</head>
<body>
<h1>HonkingMod</h1>

<div class="container">
  <div class="panel">
    <h2>Account</h2>
    <div id="auth-area">
      <input id="reg-email" placeholder="Email"><br>
      <input id="reg-pass" type="password" placeholder="Password"><br>
      <input id="reg-nick" placeholder="Nickname"><br>
      <button id="btn-register">Register</button>
      <hr>
      <input id="log-email" placeholder="Email"><br>
      <input id="log-pass" type="password" placeholder="Password"><br>
      <button id="btn-login">Login</button>
      <button id="btn-logout">Logout</button>
    </div>
    <div id="me-name"></div>
    <div id="license-card" style="display:none;"></div>
  </div>

  <div class="panel">
    <h2>Canvas</h2>
    <div style="display:flex;align-items:center;">
      <div class="avatar" id="canvas-avatar">ðŸ™‚</div>
      <div id="canvas-name">Guest</div>
    </div>
    <p>Current user: <span id="top-current">(none)</span></p>
    <button id="honkhonk" disabled>HONK!</button>
    <h2>Games</h2>
    <button id="btn-smk" disabled>Play Super Mario Kart</button>
    <button id="btn-s3ak" disabled>Play Sonic 3 & Knuckles</button>
    <button id="btn-terraria" disabled>Play Terraria</button>
    <button id="btn-mc" disabled>Play Minecraft</button>
  </div>

  <div class="panel">
    <h2>Users</h2>
    <div id="users-list"></div>
    <h2>Chat</h2>
    <div id="messages"></div>
    <input id="chat-input" placeholder="Type message..." disabled>
    <button id="send-chat" disabled>Send</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAgsn_BkIWvlenmsAOXaWGfkuGH0H50AiM",
  authDomain: "honkingmod.firebaseapp.com",
  projectId: "honkingmod",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const $id = id => document.getElementById(id);
let messagesUnsub = null;

function generateLicense() {
  return "HM-" + Math.random().toString(36).substr(2,6).toUpperCase();
}

// Register
$id('btn-register').onclick = async () => {
  const email = $id('reg-email').value;
  const pass = $id('reg-pass').value;
  const nick = $id('reg-nick').value || "Anon";
  try {
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    const license = generateLicense();
    await db.collection('users').doc(cred.user.uid).set({displayName:nick, license:license});
    alert("Registered! Your license: " + license);
  } catch(e) { alert(e.message); }
};

// Login
$id('btn-login').onclick = () => {
  auth.signInWithEmailAndPassword($id('log-email').value, $id('log-pass').value)
    .catch(e=>alert(e.message));
};
$id('btn-logout').onclick = ()=>auth.signOut();

// Send message
$id('send-chat').onclick = async ()=>{
  const msg = $id('chat-input').value;
  if(msg.trim()==='') return;
  const user = auth.currentUser;
  const snap = await db.collection('users').doc(user.uid).get();
  const nickname = snap.exists ? snap.data().displayName : "Anon";
  await db.collection('messages').add({
    uid:user.uid, displayName:nickname, text:msg, time:Date.now()
  });
  $id('chat-input').value='';
};

// HONK
$id('honkhonk').onclick = ()=>{
  const user = auth.currentUser;
  if(!user) return;
  alert("ðŸ¦† HONK from "+$id('canvas-name').textContent+"!");
};

// Game buttons
$id('btn-smk').onclick = ()=>window.location.href="SMK.html";
$id('btn-s3ak').onclick = ()=>window.location.href="s3ak.html";
$id('btn-terraria').onclick = ()=>window.location.href="Terraria.html";
$id('btn-mc').onclick = ()=>window.location.href="MCHMEC0.6.html";

// Auth state
auth.onAuthStateChanged(async user=>{
  if(user){
    const snap = await db.collection('users').doc(user.uid).get();
    const nickname = snap.exists ? snap.data().displayName : "Anon";
    const license = snap.exists ? snap.data().license : "N/A";

    $id('me-name').textContent='Logged in as '+nickname;
    $id('canvas-name').textContent=nickname;
    $id('canvas-avatar').textContent=nickname[0].toUpperCase();
    $id('top-current').textContent=nickname;

    $id('license-card').style.display="block";
    $id('license-card').innerHTML="HonkingMod License<br>"+license;

    $id('chat-input').disabled=false;
    $id('send-chat').disabled=false;
    $id('honkhonk').disabled=false;

    // Enable game buttons
    $id('btn-smk').disabled=false;
    $id('btn-s3ak').disabled=false;
    $id('btn-terraria').disabled=false;
    $id('btn-mc').disabled=false;

    // Users list
    db.collection('users').onSnapshot(s=>{
      $id('users-list').innerHTML='';
      s.forEach(doc=>{
        const u = doc.data();
        const div=document.createElement('div');
        div.className='user-item';
        div.innerHTML='<div class="avatar">'+u.displayName[0].toUpperCase()+'</div><div>'+u.displayName+'</div>';
        $id('users-list').appendChild(div);
      });
    });

    // Messages
    if(messagesUnsub) messagesUnsub();
    messagesUnsub = db.collection('messages').orderBy('time').onSnapshot(s=>{
      $id('messages').innerHTML='';
      s.forEach(doc=>{
        const m=doc.data();
        const div=document.createElement('div');
        div.className='msg';
        div.textContent = m.displayName+": "+m.text;
        $id('messages').appendChild(div);
      });
      $id('messages').scrollTop=$id('messages').scrollHeight;
    });
  }else{
    $id('me-name').textContent='';
    $id('canvas-name').textContent='Guest';
    $id('canvas-avatar').textContent='ðŸ™‚';
    $id('top-current').textContent='(none)';
    $id('license-card').style.display="none";
    $id('chat-input').disabled=true;
    $id('send-chat').disabled=true;
    $id('honkhonk').disabled=true;

    // Disable game buttons
    $id('btn-smk').disabled=true;
    $id('btn-s3ak').disabled=true;
    $id('btn-terraria').disabled=true;
    $id('btn-mc').disabled=true;

    $id('users-list').innerHTML='';
    $id('messages').innerHTML='';
    if(messagesUnsub) messagesUnsub();
  }
});
</script>
</body>
</html>
