<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HonkingMod</title>
<style>
:root { --bg:#87ceeb; --panel:#ffe680; --accent:#ff9900; --danger:#ff0033; --border:#333; --muted:#444; }
html,body{margin:0;height:100%;font-family:Tahoma,Verdana,sans-serif;background:var(--bg);}
.app{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-columns:280px 1fr;gap:12px;}
.card{background:var(--panel);border:3px solid var(--border);padding:10px;border-radius:6px;box-shadow:4px 4px 0 #000;}
h1,h2{margin:6px 0;font-weight:bold;color:#000;text-shadow:1px 1px #fff;}
label{display:block;margin-top:6px;font-size:13px;font-weight:bold;}
input[type=text],input[type=password]{width:100%;padding:6px;border-radius:4px;border:2px inset #ccc;background:#fff;color:#000;font-size:13px;}
button{cursor:pointer;padding:6px 10px;border-radius:4px;border:2px outset #999;background:var(--accent);color:#fff;font-weight:bold;box-shadow:2px 2px 0 #000;}
button:active{border:2px inset #999;box-shadow:none;}
.muted{color:var(--muted);font-size:12px;}
.users-list{max-height:260px;overflow:auto;margin-top:10px;}
.user-item{display:flex;align-items:center;gap:8px;padding:6px;background:#fff;border:2px solid #000;margin:4px 0;}
.avatar{width:32px;height:32px;border:2px solid #000;border-radius:4px;background:#ffcc00;display:flex;align-items:center;justify-content:center;font-weight:bold;}
.main{display:flex;flex-direction:column;gap:12px;}
.topbar{display:flex;justify-content:space-between;align-items:center;background:#ffcc66;border:3px solid #000;}
.world{height:400px;border:3px solid #000;border-radius:6px;display:flex;overflow:hidden;background:#c0ffc0;}
.canvas{flex:1;background:#99ddff;display:flex;flex-direction:column;}
.chat{width:280px;border-left:3px solid #000;display:flex;flex-direction:column;background:#fffbe6;}
.messages{flex:1;padding:8px;overflow:auto;font-size:13px;}
.msg{margin-bottom:6px;border-bottom:1px dashed #aaa;padding-bottom:4px;}
.composer{display:flex;padding:6px;gap:6px;background:#ffeb99;border-top:3px solid #000;}
.composer input{flex:1;}
.danger{background:var(--danger)!important;}
footer{margin-top:12px;text-align:center;font-size:12px;color:#000;}
@media(max-width:900px){.app{grid-template-columns:1fr;}.world{height:300px;flex-direction:column;}.chat{width:100%;border-left:none;border-top:3px solid #000;}}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1>HonkingMod Accounts</h1>
    <div id="auth-area"></div>
    <div id="account-controls" style="display:none;margin-top:12px">
      <div style="background:#fff;padding:6px;border:2px solid #000;margin-bottom:6px">Logged in as <strong id="me-name"></strong></div>
      <label>Display name</label>
      <input id="display-name" type="text" />
      <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap">
        <button id="save-profile">Save</button>
        <button id="logout">Logout</button>
        <button id="delete-account" class="danger">Delete</button>
      </div>
    </div>
    <hr style="margin:10px 0;border:2px dashed #000">
    <h2>Users</h2>
    <div class="muted">Accounts and chat are stored online.</div>
    <div class="users-list" id="users-list"></div>
  </div>
  <div class="main">
    <div class="card topbar">
      <div><h1>HonkingMod World</h1><div class="muted">Scratch + 2008 Roblox style</div></div>
      <div class="muted">Current: <span id="top-current">(none)</span></div>
    </div>
    <div class="world">
      <div class="canvas">
        <div style="padding:6px;display:flex;gap:8px;align-items:center;background:#ffeb99;border-bottom:3px solid #000">
          <div class="avatar" id="canvas-avatar">ðŸ™‚</div>
          <div><div id="canvas-name">Guest</div><div class="muted">Click HONK!</div></div>
        </div>
        <div style="padding:12px;flex:1">
          <button id="honkhonk" disabled>HONK!</button>
          <p class="muted" style="margin-top:6px">Wacky test world.</p>
        </div>
      </div>
      <div class="chat">
        <div style="padding:6px;border-bottom:3px solid #000;background:#ffcc66"><strong>Global Chat</strong></div>
        <div class="messages" id="messages"></div>
        <div class="composer">
          <input id="chat-input" type="text" placeholder="Say something..." disabled/>
          <button id="send-chat" disabled>Send</button>
        </div>
      </div>
    </div>
    <footer class="card">HonkingMod â€” powered by Firebase. Shared chat/accounts.</footer>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAgsn_BkIWvlenmsAOXaWGfkuGH0H50AiM",
  authDomain: "honkingmod.firebaseapp.com",
  projectId: "honkingmod",
  storageBucket: "honkingmod.appspot.com",
  messagingSenderId: "484991397323",
  appId: "1:484991397323:web:5b1f72eaa0b6c3d0abcdef"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function $id(id){return document.getElementById(id);}
function $(sel){return document.querySelector(sel);}
function escapeHtml(s){return String(s).replace(/[&<>\"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\\'':'&#39;'}[m]));}

function renderAuth(){
  const area = $id('auth-area');
  area.innerHTML = `
    <label>Email</label><input id='auth-email' type='text' placeholder='Enter email'/>
    <label>Password</label><input id='auth-password' type='password' placeholder='Enter password'/>
    <div style='margin-top:6px;display:flex;gap:6px'>
      <button id='btn-register'>Register</button>
      <button id='btn-login'>Login</button>
    </div>
  `;

  $id('btn-register').addEventListener('click',()=>{
    const email=$id('auth-email').value.trim();
    const pass=$id('auth-password').value;
    if(!email||!pass){alert('Enter email and password'); return;}
    auth.createUserWithEmailAndPassword(email,pass)
      .then(()=>{alert('Registered successfully!');})
      .catch(e=>alert('Error: '+e.message));
  });

  $id('btn-login').addEventListener('click',()=>{
    const email=$id('auth-email').value.trim();
    const pass=$id('auth-password').value;
    if(!email||!pass){alert('Enter email and password'); return;}
    auth.signInWithEmailAndPassword(email,pass)
      .catch(e=>alert('Error: '+e.message));
  });
}

auth.onAuthStateChanged(user=>{
  if(user){
    $id('auth-area').style.display='none';
    $id('account-controls').style.display='block';
    $id('me-name').textContent=user.email;
    $id('display-name').value=user.email;
    $id('top-current').textContent=user.email;
    $id('canvas-name').textContent=user.email;
    $id('canvas-avatar').textContent=user.email[0].toUpperCase();
    enableChat(); renderUsersList(); renderMessages();
  } else {
    $id('auth-area').style.display='block';
    $id('account-controls').style.display='none';
    $id('top-current').textContent='(none)';
    $id('canvas-name').textContent='Guest';
    $id('canvas-avatar').textContent='ðŸ™‚';
    $('#chat-input').disabled=true;
    $('#send-chat').disabled=true;
    $('#honkhonk').disabled=true;
  }
});

$id('logout').addEventListener('click',()=>{auth.signOut();});

function renderUsersList(){
  const list=$id('users-list');
  const user=auth.currentUser;
  if(user){
    list.innerHTML=`<div class='user-item'><div class='avatar'>${escapeHtml(user.email[0].toUpperCase())}</div><div><strong>${escapeHtml(user.email)}</strong></div></div>`;
  }else list.innerHTML='<div class="muted">No user logged in.</div>';
}

function renderMessages(){
  db.collection('messages').orderBy('time').onSnapshot(snapshot=>{
    const container=$id('messages');
    container.innerHTML='';
    snapshot.forEach(doc=>{
      const m=doc.data();
      const div=document.createElement('div');
      div.className='msg';
      div.innerHTML=`<strong>${escapeHtml(m.author)}</strong>: ${escapeHtml(m.text)}<div class='muted'>${new Date(m.time).toLocaleTimeString()}</div>`;
      container.appendChild(div);
    });
    container.scrollTop=container.scrollHeight;
  });
}

function enableChat(){
  $('#chat-input').disabled=false;
  $('#send-chat').disabled=false;
  $('#honkhonk').disabled=false;
}

function sendChat(){
  const text=$('#chat-input').value.trim();
  const user=auth.currentUser;
  if(!text||!user) return;
  db.collection('messages').add({author:user.email,text,time:Date.now()});
  $('#chat-input').value='';
}

$('#send-chat').addEventListener('click',sendChat);
$('#chat-input').addEventListener('keydown',e=>{if(e.key==='Enter')sendChat();});
$('#honkhonk').addEventListener('click',()=>{
  const user=auth.currentUser;
  if(!user)return;
  db.collection('messages').add({author:user.email,text:'HONK!',time:Date.now()});
});

window.onload = function(){
  renderAuth();
};
</script>
</body>
</html>
